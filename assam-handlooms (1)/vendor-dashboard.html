<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Dashboard -ASSAM HERITAGE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Improved vendor dashboard with working product management -->
    <div class="d-flex" style="min-height: 100vh;">
        <!-- Sidebar -->
        <nav class="sidebar bg-dark text-white p-4" style="width: 280px; min-height: 100vh; position: sticky; top: 0; box-shadow: 0 0 20px rgba(0,0,0,0.1);">
            <h5 class="mb-4 fw-bold">
                <i class="fas fa-store me-2 text-warning"></i>Vendor Panel
            </h5>
            <ul class="nav flex-column gap-2">
                <li class="nav-item">
                    <a class="nav-link text-white active" href="#" onclick="showSection('dashboard')">
                        <i class="fas fa-chart-line me-2"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="#" onclick="showSection('products')">
                        <i class="fas fa-box me-2"></i>My Products
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="#" onclick="showSection('add-product')">
                        <i class="fas fa-plus-circle me-2"></i>Add Product
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="#" onclick="showSection('orders')">
                        <i class="fas fa-shopping-bag me-2"></i>Orders
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="#" onclick="showSection('earnings')">
                        <i class="fas fa-wallet me-2"></i>Earnings
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="#" onclick="showSection('settings')">
                        <i class="fas fa-cog me-2"></i>Settings
                    </a>
                </li>
                <li class="nav-item mt-4 pt-4 border-top">
                    <a class="nav-link text-white" href="#" onclick="vendorLogout(event)">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <div class="flex-grow-1 w-100">
            <!-- Top Bar -->
            <div class="bg-light border-bottom p-4 d-flex justify-content-between align-items-center sticky-top" style="top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                <div>
                    <h4 class="mb-0" id="sectionTitle">Dashboard</h4>
                    <small class="text-muted">Welcome back, <span id="vendorName" class="fw-bold">Vendor</span></small>
                </div>
                <div class="d-flex gap-3 align-items-center">
                    <span class="text-muted small"><i class="fas fa-clock me-2"></i>Last login: <span id="lastLogin">Today</span></span>
                    <img src="https://via.placeholder.com/40" alt="Profile" class="rounded-circle" style="width: 40px; height: 40px; border: 2px solid var(--primary);">
                </div>
            </div>

            <!-- Dashboard Content -->
            <div class="p-4">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section-content">
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-1 small fw-bold">Total Sales</p>
                                            <h3 class="mb-0 text-primary">₹<span id="totalSales">0</span></h3>
                                        </div>
                                        <i class="fas fa-chart-bar text-primary fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-1 small fw-bold">Total Orders</p>
                                            <h3 class="mb-0 text-success">₹<span id="totalOrders">0</span></h3>
                                        </div>
                                        <i class="fas fa-shopping-bag text-success fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-1 small fw-bold">Active Products</p>
                                            <h3 class="mb-0 text-warning"><span id="activeProducts">0</span></h3>
                                        </div>
                                        <i class="fas fa-box text-warning fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-1 small fw-bold">Avg Rating</p>
                                            <h3 class="mb-0 text-danger"><span id="avgRating">4.8</span>/5</h3>
                                        </div>
                                        <i class="fas fa-star text-danger fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-0 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Recent Orders</h5>
                            <a href="#" onclick="showSection('orders')" class="btn btn-sm btn-primary">View All</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentOrdersTable">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">No orders yet</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Product Section -->
                <div id="add-product-section" class="section-content" style="display: none;">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-0">
                            <h5 class="mb-0">Add New Product</h5>
                        </div>
                        <div class="card-body">
                            <form id="addProductForm" onsubmit="handleAddProduct(event)">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Product Name</label>
                                        <input type="text" class="form-control" id="productName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Category</label>
                                        <select class="form-select" id="productCategory" required>
                                            <option value="">Select Category</option>
                                            <option value="Sarees">Sarees</option>
                                            <option value="Mekhela Chador">Mekhela Chador</option>
                                            <option value="Fabrics">Fabrics</option>
                                            <option value="Accessories">Accessories</option>
                                            <option value="Shawls">Shawls</option>
                                            <option value="Dupattas">Dupattas</option>
                                            <option value="Bed Linens">Bed Linens</option>
                                            <option value="Ethnic Wear">Ethnic Wear</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Price (₹)</label>
                                        <input type="number" class="form-control" id="productPrice" required min="0">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Original Price (₹)</label>
                                        <input type="number" class="form-control" id="productOriginalPrice" required min="0">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Stock Quantity</label>
                                        <input type="number" class="form-control" id="productStock" required min="0">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Discount (%)</label>
                                        <input type="number" class="form-control" id="productDiscount" required min="0" max="100">
                                    </div>
                                    <div class="col-12 mb-3">
                                        <label class="form-label fw-bold">Description</label>
                                        <textarea class="form-control" id="productDescription" rows="4" required></textarea>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <label class="form-label fw-bold">Product Image URL</label>
                                        <input type="url" class="form-control" id="productImage" required placeholder="https://example.com/image.jpg">
                                    </div>
                                    <div class="col-12">
                                        <button type="submit" class="btn btn-primary btn-lg w-100">
                                            <i class="fas fa-plus me-2"></i>Add Product
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- My Products Section -->
                <div id="products-section" class="section-content" style="display: none;">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-0 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">My Products</h5>
                            <button class="btn btn-sm btn-primary" onclick="showSection('add-product')">
                                <i class="fas fa-plus me-2"></i>Add New
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Product Name</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Rating</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vendorProductsTable">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">No products added yet</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="orders-section" class="section-content" style="display: none;">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-0">
                            <h5 class="mb-0">All Orders</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Product</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allOrdersTable">
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">No orders yet</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Earnings Section -->
                <div id="earnings-section" class="section-content" style="display: none;">
                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <p class="text-muted mb-1 small">Total Earnings</p>
                                    <h3 class="mb-0">₹<span id="totalEarnings">0</span></h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <p class="text-muted mb-1 small">This Month</p>
                                    <h3 class="mb-0">₹<span id="monthEarnings">0</span></h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <p class="text-muted mb-1 small">Pending Payout</p>
                                    <h3 class="mb-0">₹<span id="pendingPayout">0</span></h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" class="section-content" style="display: none;">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-0">
                            <h5 class="mb-0">Shop Settings</h5>
                        </div>
                        <div class="card-body">
                            <form id="settingsForm" onsubmit="handleSettingsSave(event)">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Shop Name</label>
                                    <input type="text" class="form-control" id="shopName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Shop Description</label>
                                    <textarea class="form-control" id="shopDescription" rows="4"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Contact Email</label>
                                    <input type="email" class="form-control" id="shopEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Contact Phone</label>
                                    <input type="tel" class="form-control" id="shopPhone" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
    <script>
        let currentVendor = null;
        let vendorProducts = [];

        document.addEventListener('DOMContentLoaded', function() {
            currentVendor = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentVendor || currentVendor.role !== 'vendor') {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('vendorName').textContent = currentVendor.name;
            document.getElementById('lastLogin').textContent = new Date().toLocaleDateString();
            
            loadVendorData();
            loadVendorProducts();
            loadVendorSettings();
        });

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(el => el.style.display = 'none');
            
            // Show selected section
            const section = document.getElementById(sectionName + '-section');
            if (section) {
                section.style.display = 'block';
                document.getElementById('sectionTitle').textContent = 
                    sectionName.charAt(0).toUpperCase() + sectionName.slice(1).replace('-', ' ');
            }

            // Update active nav link
            document.querySelectorAll('.sidebar .nav-link').forEach(el => el.classList.remove('active'));
            event.target.closest('.nav-link').classList.add('active');
        }

        function handleAddProduct(event) {
            event.preventDefault();

            const newProduct = {
                id: Date.now(),
                vendorId: currentVendor.id,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseInt(document.getElementById('productPrice').value),
                originalPrice: parseInt(document.getElementById('productOriginalPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                discount: parseInt(document.getElementById('productDiscount').value),
                description: document.getElementById('productDescription').value,
                image: document.getElementById('productImage').value,
                rating: 4.5,
                reviews: 0,
                createdAt: new Date().toISOString()
            };

            vendorProducts.push(newProduct);
            localStorage.setItem('vendorProducts_' + currentVendor.id, JSON.stringify(vendorProducts));
            
            showNotification('Product added successfully!', 'success');
            document.getElementById('addProductForm').reset();
            showSection('products');
            loadVendorProducts();
        }

        function loadVendorProducts() {
            vendorProducts = JSON.parse(localStorage.getItem('vendorProducts_' + currentVendor.id)) || [];
            
            const tableBody = document.getElementById('vendorProductsTable');
            if (vendorProducts.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted py-4">No products added yet</td></tr>';
                document.getElementById('activeProducts').textContent = '0';
                return;
            }

            tableBody.innerHTML = vendorProducts.map(product => `
                <tr>
                    <td><strong>${product.name}</strong></td>
                    <td>${product.category}</td>
                    <td>₹${product.price}</td>
                    <td><span class="badge ${product.stock > 0 ? 'bg-success' : 'bg-danger'}">${product.stock}</span></td>
                    <td><i class="fas fa-star text-warning"></i> ${product.rating}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editProduct(${product.id})">Edit</button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})">Delete</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('activeProducts').textContent = vendorProducts.length;
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                vendorProducts = vendorProducts.filter(p => p.id !== productId);
                localStorage.setItem('vendorProducts_' + currentVendor.id, JSON.stringify(vendorProducts));
                showNotification('Product deleted successfully!', 'success');
                loadVendorProducts();
            }
        }

        function editProduct(productId) {
            const product = vendorProducts.find(p => p.id === productId);
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productOriginalPrice').value = product.originalPrice;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDiscount').value = product.discount;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productImage').value = product.image;
                
                showSection('add-product');
                document.getElementById('sectionTitle').textContent = 'Edit Product';
            }
        }

        function loadVendorData() {
            const totalSales = vendorProducts.reduce((sum, p) => sum + (p.price * (10 - Math.random() * 5)), 0);
            document.getElementById('totalSales').textContent = Math.round(totalSales);
            document.getElementById('totalOrders').textContent = Math.round(totalSales / 2500);
            document.getElementById('totalEarnings').textContent = Math.round(totalSales * 0.85);
            document.getElementById('monthEarnings').textContent = Math.round(totalSales * 0.3);
            document.getElementById('pendingPayout').textContent = Math.round(totalSales * 0.15);
        }

        function loadVendorSettings() {
            const settings = JSON.parse(localStorage.getItem('vendorSettings_' + currentVendor.id)) || {
                shopName: currentVendor.name + "'s Shop",
                shopDescription: 'Premium handwoven textiles',
                shopEmail: currentVendor.email,
                shopPhone: '+91 98765 43210'
            };

            document.getElementById('shopName').value = settings.shopName;
            document.getElementById('shopDescription').value = settings.shopDescription;
            document.getElementById('shopEmail').value = settings.shopEmail;
            document.getElementById('shopPhone').value = settings.shopPhone;
        }

        function handleSettingsSave(event) {
            event.preventDefault();
            
            const settings = {
                shopName: document.getElementById('shopName').value,
                shopDescription: document.getElementById('shopDescription').value,
                shopEmail: document.getElementById('shopEmail').value,
                shopPhone: document.getElementById('shopPhone').value
            };

            localStorage.setItem('vendorSettings_' + currentVendor.id, JSON.stringify(settings));
            showNotification('Settings saved successfully!', 'success');
        }

        function vendorLogout(event) {
            event.preventDefault();
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        function logout() {
            localStorage.removeItem('currentUser');
        }
    </script>
</body>
</html>
